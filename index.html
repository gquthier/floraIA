<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itin√©rairePro - G√©n√©rateur d'itin√©raires automatique</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-route"></i>
                <span>Itin√©rairePro</span>
            </div>
            <nav class="nav">
                <a href="#" class="nav-link active">Nouveau</a>
                <a href="#" class="nav-link">Mes itin√©raires</a>
                <a href="#" class="nav-link">Base de donn√©es</a>
                <a href="#" class="nav-link" onclick="openSettingsModal(); return false;">Param√®tres</a>
            </nav>
            <div class="user-profile">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Infos Client</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Activit√©s</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Transferts</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Personnalisation</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Export</div>
                </div>
            </div>

            <!-- Step 1: Client Info -->
            <div class="step-content active" id="step1">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-user"></i>
                        Informations Client
                    </h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nom du client *</label>
                            <input type="text" class="form-input" id="clientName" placeholder="Ex: Famille Dupont">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-input" id="clientEmail" placeholder="client@email.com">
                        </div>
                        <div class="form-group">
                            <label>Nombre de personnes *</label>
                            <input type="number" class="form-input" id="nbPersons" value="2" min="1">
                        </div>
                        <div class="form-group">
                            <label>Budget estim√© (‚Ç¨)</label>
                            <input type="number" class="form-input" id="budget" placeholder="2000">
                        </div>
                        <div class="form-group full-width">
                            <label>Date de d√©but *</label>
                            <input type="date" class="form-input" id="startDate">
                        </div>
                        <div class="form-group full-width">
                            <label>Date de fin *</label>
                            <input type="date" class="form-input" id="endDate">
                        </div>
                        <div class="form-group full-width">
                            <label>Notes / Pr√©f√©rences</label>
                            <textarea class="form-input" id="clientNotes" rows="3" placeholder="Pr√©f√©rences alimentaires, mobilit√© r√©duite, etc."></textarea>
                        </div>
                    </div>
                    <div class="duration-info" id="durationInfo">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Dur√©e du s√©jour : <strong id="tripDuration">-- jours</strong></span>
                    </div>
                </div>
            </div>

            <!-- Step 2: Activities -->
            <div class="step-content" id="step2">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-hiking"></i>
                        Planifier les activit√©s jour par jour
                    </h2>
                    <div id="daysContainer"></div>
                </div>
            </div>

            <!-- Step 3: Transfers -->
            <div class="step-content" id="step3">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-car"></i>
                        Transferts et Transport
                    </h2>
                    <div id="transfersContainer"></div>
                    <button class="btn-secondary" id="addTransfer">
                        <i class="fas fa-plus"></i> Ajouter un transfert
                    </button>
                </div>
            </div>

            <!-- Step 4: Customization -->
            <div class="step-content" id="step4">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-images"></i>
                        Personnalisation & Photos
                    </h2>
                    <div class="preview-section">
                        <div class="preview-column">
                            <h3>Aper√ßu de l'itin√©raire</h3>
                            <div id="itineraryPreview" class="itinerary-preview">
                                <!-- Generated preview will go here -->
                            </div>
                        </div>
                        <div class="upload-column">
                            <h3>Ajouter des photos</h3>
                            <div class="drag-drop-zone" id="dragDropZone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Glissez-d√©posez vos photos ici</p>
                                <p class="small">ou cliquez pour parcourir</p>
                                <input type="file" id="photoUpload" multiple accept="image/*" style="display: none;">
                            </div>
                            <div id="uploadedPhotos" class="uploaded-photos"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Export -->
            <div class="step-content" id="step5">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-file-export"></i>
                        Export et Documents
                    </h2>
                    <div class="export-options">
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h3>Itin√©raire Client</h3>
                            <p>Document PDF professionnel avec photos et d√©tails complets</p>
                            <button class="btn-primary" id="exportClientPDF">
                                <i class="fas fa-download"></i> T√©l√©charger PDF
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-file-word"></i>
                            </div>
                            <h3>Document Word</h3>
                            <p>Version √©ditable pour modifications finales</p>
                            <button class="btn-primary" id="exportClientWord">
                                <i class="fas fa-download"></i> T√©l√©charger Word
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <h3>R√©capitulatif Chauffeurs</h3>
                            <p>Document avec contacts, liens Google Maps et horaires</p>
                            <button class="btn-primary" id="exportDriverDoc">
                                <i class="fas fa-download"></i> T√©l√©charger Recap
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-file-excel"></i>
                            </div>
                            <h3>Quotation Excel</h3>
                            <p>Tableau d√©taill√© des co√ªts et marges</p>
                            <button class="btn-primary" id="exportQuotation">
                                <i class="fas fa-download"></i> T√©l√©charger Excel
                            </button>
                        </div>
                    </div>
                    <div class="summary-section">
                        <h3>R√©sum√© de l'itin√©raire</h3>
                        <div id="finalSummary" class="final-summary"></div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button class="btn-secondary" id="prevBtn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Pr√©c√©dent
                </button>
                <button class="btn-primary" id="nextBtn">
                    Suivant <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>

    <script src="database.js"></script>
    <script src="config.js"></script>
    <script src="csv-parser.js"></script>
    <script src="ai-assistant.js"></script>
    <script src="app.js"></script>
    <script src="export-engine.js"></script>
</body>
</html>
<!-- Modal pour configurer la cl√© API (√† ajouter dans index.html) -->
<div id="settingsModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>‚öôÔ∏è Param√®tres</h2>
            <button class="close-modal" onclick="closeSettingsModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div style="padding: 1rem 0;">
            <div class="settings-section">
                <h3>ü§ñ Intelligence Artificielle (Optionnel)</h3>
                <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">
                    Activez l'IA pour des suggestions personnalis√©es et descriptions am√©lior√©es.
                </p>
                
                <div class="form-group">
                    <label>Cl√© API OpenAI</label>
                    <div style="position: relative;">
                        <input 
                            type="password" 
                            id="openaiKeyInput" 
                            class="form-input" 
                            placeholder="sk-proj-..."
                            style="padding-right: 100px;"
                        >
                        <button 
                            onclick="toggleKeyVisibility()" 
                            style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #64748b;"
                        >
                            <i class="fas fa-eye" id="toggleKeyIcon"></i>
                        </button>
                    </div>
                    <small style="color: #64748b;">
                        üîí Votre cl√© est stock√©e localement et ne sera jamais partag√©e.
                        <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #2563eb;">Obtenir une cl√©</a>
                    </small>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button onclick="saveOpenAIKey()" class="btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                    <button onclick="clearOpenAIKey()" class="btn-secondary">
                        <i class="fas fa-trash"></i> Supprimer la cl√©
                    </button>
                </div>
                
                <div id="aiStatus" style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; display: none;">
                    <strong>Statut :</strong> <span id="aiStatusText"></span>
                </div>
            </div>
            
            <div class="settings-section" style="margin-top: 2rem;">
                <h3>üí° Fonctionnalit√©s IA disponibles</h3>
                <ul style="color: #64748b; font-size: 0.875rem;">
                    <li>‚ú® Descriptions d'activit√©s am√©lior√©es</li>
                    <li>üéØ Suggestions d'activit√©s compl√©mentaires</li>
                    <li>üìù R√©sum√©s d'itin√©raires personnalis√©s</li>
                    <li>üîç Recherche s√©mantique avanc√©e (√† venir)</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function openSettingsModal() {
    document.getElementById('settingsModal').classList.add('active');
    
    // Charger la cl√© existante (masqu√©e)
    const existingKey = localStorage.getItem('openai_api_key');
    if (existingKey) {
        document.getElementById('openaiKeyInput').value = existingKey;
        updateAIStatus(true);
    }
}

function closeSettingsModal() {
    document.getElementById('settingsModal').classList.remove('active');
}

function toggleKeyVisibility() {
    const input = document.getElementById('openaiKeyInput');
    const icon = document.getElementById('toggleKeyIcon');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

function saveOpenAIKey() {
    const key = document.getElementById('openaiKeyInput').value.trim();
    
    if (!key) {
        alert('‚ùå Veuillez entrer une cl√© API');
        return;
    }
    
    if (!key.startsWith('sk-')) {
        alert('‚ùå Format de cl√© invalide. Une cl√© OpenAI commence par "sk-"');
        return;
    }
    
    if (setOpenAIKey(key)) {
        updateAIStatus(true);
        showNotification('‚úÖ Cl√© API sauvegard√©e avec succ√®s', 'success');
        
        // R√©initialiser l'assistant AI
        if (typeof initializeAI === 'function') {
            initializeAI();
        }
    }
}

function clearOpenAIKey() {
    if (confirm('√ätes-vous s√ªr de vouloir supprimer la cl√© API ?')) {
        if (typeof clearOpenAIKey === 'function') {
            clearOpenAIKey();
        }
        document.getElementById('openaiKeyInput').value = '';
        updateAIStatus(false);
        showNotification('üóëÔ∏è Cl√© API supprim√©e', 'success');
    }
}

function updateAIStatus(isConfigured) {
    const statusDiv = document.getElementById('aiStatus');
    const statusText = document.getElementById('aiStatusText');
    
    statusDiv.style.display = 'block';
    
    if (isConfigured) {
        statusDiv.style.background = '#d1fae5';
        statusDiv.style.color = '#065f46';
        statusText.textContent = '‚úÖ IA activ√©e - Fonctionnalit√©s disponibles';
    } else {
        statusDiv.style.background = '#fee2e2';
        statusDiv.style.color = '#991b1b';
        statusText.textContent = '‚ö†Ô∏è IA d√©sactiv√©e - Aucune cl√© configur√©e';
    }
}
</script>

<style>
.settings-section h3 {
    font-size: 1.125rem;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.settings-section ul {
    padding-left: 1.5rem;
    line-height: 1.8;
}
</style>
