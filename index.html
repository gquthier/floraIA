<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baliwithflow - Organic Travel Experiences</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="organic-luxury.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <svg class="logo-icon" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 2C16 2 8 8 8 16C8 20.4183 11.5817 24 16 24C20.4183 24 24 20.4183 24 16C24 8 16 2 16 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 24C16 24 12 27 12 30" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <span class="logo-text">Baliwithflow</span>
            </div>
            <nav class="nav">
                <a href="index.html" class="nav-link active">New</a>
                <a href="my-itineraries.html" class="nav-link">My Itineraries</a>
                <a href="my-itineraries.html#activities" class="nav-link">Database</a>
                <a href="#" class="nav-link" onclick="openSettingsModal(); return false;">Settings</a>
            </nav>
            <div class="user-profile">
                <i class="fas fa-user-circle"></i>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Progress Steps -->
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Client Info</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Activities</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Transfers</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Customization</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="5">
                    <div class="step-number">5</div>
                    <div class="step-label">Export</div>
                </div>
            </div>

            <!-- Step 1: Client Info -->
            <div class="step-content active" id="step1">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-user"></i>
                        Client Information
                    </h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Client Name *</label>
                            <input type="text" class="form-input" id="clientName" placeholder="e.g. Smith Family">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-input" id="clientEmail" placeholder="client@email.com">
                        </div>
                        <div class="form-group">
                            <label>WhatsApp Number *</label>
                            <input type="tel" class="form-input" id="clientWhatsapp" placeholder="+33 6 XX XX XX XX">
                        </div>
                        <div class="form-group">
                            <label>Number of Guests *</label>
                            <input type="number" class="form-input" id="nbPersons" value="2" min="1">
                        </div>
                        <div class="form-group">
                            <label>Start Date *</label>
                            <input type="date" class="form-input" id="startDate">
                        </div>
                        <div class="form-group">
                            <label>End Date *</label>
                            <input type="date" class="form-input" id="endDate">
                        </div>
                        <div class="form-group full-width">
                            <label>Notes / Preferences</label>
                            <textarea class="form-input" id="clientNotes" rows="3" placeholder="Dietary requirements, mobility needs, special requests..."></textarea>
                        </div>
                    </div>
                    <div class="duration-info" id="durationInfo">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Trip Duration: <strong id="tripDuration">-- days, -- nights</strong></span>
                    </div>

                    <!-- Trip Zones Section -->
                    <div class="zones-container">
                        <div class="zones-header">
                            <h3><i class="fas fa-map-marked-alt"></i> Trip Zones</h3>
                            <button type="button" class="add-zone-btn" onclick="addZone()">
                                <i class="fas fa-plus"></i> Add Zone
                            </button>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                            Define the different areas your client will visit during their trip.
                        </p>
                        <div id="zonesContainer">
                            <!-- Zone cards will be added here dynamically -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Activities -->
            <div class="step-content" id="step2">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-hiking"></i>
                        Plan Activities Day by Day
                    </h2>
                    <div id="daysContainer"></div>
                </div>
            </div>

            <!-- Step 3: Transfers -->
            <div class="step-content" id="step3">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-car"></i>
                        Transfers & Transportation
                    </h2>
                    <div id="transfersContainer"></div>
                    <button class="btn-secondary" id="addTransfer">
                        <i class="fas fa-plus"></i> Add Transfer
                    </button>
                </div>
            </div>

            <!-- Step 4: Customization -->
            <div class="step-content" id="step4">
                <!-- Accommodations Section -->
                <div class="card" style="margin-bottom: 1.5rem;">
                    <h2 class="card-title">
                        <i class="fas fa-hotel"></i>
                        Accommodations
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Add accommodation details for internal pricing. Hotel names will only appear in driver documents.
                    </p>
                    <div id="accommodationsContainer">
                        <!-- Accommodation cards will be added here -->
                    </div>
                    <button type="button" class="add-zone-btn" onclick="addAccommodation()" style="margin-top: 1rem;">
                        <i class="fas fa-plus"></i> Add Accommodation
                    </button>
                </div>

                <!-- Preview & Photos Section -->
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-images"></i>
                        Preview & Photos
                    </h2>
                    <div class="preview-section">
                        <div class="preview-column">
                            <h3>Itinerary Preview</h3>
                            <div id="itineraryPreview" class="itinerary-preview">
                                <!-- Generated preview will go here -->
                            </div>
                        </div>
                        <div class="upload-column">
                            <h3>Add Photos</h3>
                            <div class="drag-drop-zone" id="dragDropZone">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Drag & drop your photos here</p>
                                <p class="small">or click to browse</p>
                                <input type="file" id="photoUpload" multiple accept="image/*" style="display: none;">
                            </div>
                            <div id="uploadedPhotos" class="uploaded-photos"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Export -->
            <div class="step-content" id="step5">
                <div class="card">
                    <h2 class="card-title">
                        <i class="fas fa-file-export"></i>
                        Export & Documents
                    </h2>
                    <div class="export-options">
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h3>Client Itinerary</h3>
                            <p>Professional PDF with photos and complete details</p>
                            <button class="btn-primary" id="exportClientPDF">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <h3>Client Schedule</h3>
                            <p>Day-by-day schedule with time slots</p>
                            <button class="btn-primary" id="exportClientSchedule">
                                <i class="fas fa-download"></i> Download Schedule
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <h3>Driver Briefing</h3>
                            <p>Detailed day-by-day with contacts and maps</p>
                            <button class="btn-primary" id="exportDriverDoc">
                                <i class="fas fa-download"></i> Download Briefing
                            </button>
                        </div>
                        <div class="export-card">
                            <div class="export-icon">
                                <i class="fas fa-file-excel"></i>
                            </div>
                            <h3>Internal Quotation</h3>
                            <p>Detailed pricing in IDR with USD conversion</p>
                            <button class="btn-primary" id="exportQuotation">
                                <i class="fas fa-download"></i> Download Quotation
                            </button>
                        </div>
                    </div>
                    <div class="summary-section">
                        <h3>Itinerary Summary</h3>
                        <div id="finalSummary" class="final-summary"></div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button class="btn-secondary" id="prevBtn" style="display: none;">
                    <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="btn-primary" id="nextBtn">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </main>

    <script src="database.js"></script>
    <script src="config.js"></script>
    <script src="csv-parser.js"></script>
    <script src="ai-assistant.js"></script>
    <script src="app.js"></script>
    <script src="export-engine.js"></script>
</body>
</html>
<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Settings</h2>
            <button class="close-modal" onclick="closeSettingsModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div style="padding: 1rem 0;">
            <div class="settings-section">
                <h3>AI Integration (Optional)</h3>
                <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1rem;">
                    Enable AI for personalized suggestions and enhanced descriptions.
                </p>

                <div class="form-group">
                    <label>OpenAI API Key</label>
                    <div style="position: relative;">
                        <input
                            type="password"
                            id="openaiKeyInput"
                            class="form-input"
                            placeholder="sk-proj-..."
                            style="padding-right: 100px;"
                        >
                        <button
                            onclick="toggleKeyVisibility()"
                            style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #64748b;"
                        >
                            <i class="fas fa-eye" id="toggleKeyIcon"></i>
                        </button>
                    </div>
                    <small style="color: #64748b;">
                        Your key is stored locally and never shared.
                        <a href="https://platform.openai.com/api-keys" target="_blank" style="color: #2563eb;">Get API key</a>
                    </small>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button onclick="saveOpenAIKey()" class="btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button onclick="clearOpenAIKey()" class="btn-secondary">
                        <i class="fas fa-trash"></i> Remove Key
                    </button>
                </div>

                <div id="aiStatus" style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; display: none;">
                    <strong>Status:</strong> <span id="aiStatusText"></span>
                </div>
            </div>

            <div class="settings-section" style="margin-top: 2rem;">
                <h3>Exchange Rate (USD/IDR)</h3>
                <div class="form-group">
                    <label>1 USD = IDR</label>
                    <input type="number" id="exchangeRate" class="form-input" value="15800" placeholder="15800">
                    <small style="color: #64748b;">Update this with today's exchange rate for accurate USD conversion.</small>
                </div>
            </div>

            <div class="settings-section" style="margin-top: 2rem;">
                <h3>Available AI Features</h3>
                <ul style="color: #64748b; font-size: 0.875rem;">
                    <li>Enhanced activity descriptions</li>
                    <li>Complementary activity suggestions</li>
                    <li>Personalized itinerary summaries</li>
                    <li>Advanced semantic search (coming soon)</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function openSettingsModal() {
    document.getElementById('settingsModal').classList.add('active');

    // Load existing API key (masked)
    const existingKey = localStorage.getItem('openai_api_key');
    if (existingKey) {
        document.getElementById('openaiKeyInput').value = existingKey;
        updateAIStatus(true);
    }

    // Load exchange rate
    const savedRate = localStorage.getItem('exchange_rate_usd_idr');
    if (savedRate) {
        document.getElementById('exchangeRate').value = savedRate;
    }
}

function closeSettingsModal() {
    document.getElementById('settingsModal').classList.remove('active');
}

function toggleKeyVisibility() {
    const input = document.getElementById('openaiKeyInput');
    const icon = document.getElementById('toggleKeyIcon');

    if (input.type === 'password') {
        input.type = 'text';
        icon.className = 'fas fa-eye-slash';
    } else {
        input.type = 'password';
        icon.className = 'fas fa-eye';
    }
}

function saveOpenAIKey() {
    const key = document.getElementById('openaiKeyInput').value.trim();
    const exchangeRate = document.getElementById('exchangeRate').value;

    // Save exchange rate
    if (exchangeRate) {
        localStorage.setItem('exchange_rate_usd_idr', exchangeRate);
    }

    if (!key) {
        showNotification('Exchange rate saved', 'success');
        return;
    }

    if (!key.startsWith('sk-')) {
        alert('Invalid API key format. OpenAI keys start with "sk-"');
        return;
    }

    if (setOpenAIKey(key)) {
        updateAIStatus(true);
        showNotification('API key and settings saved successfully', 'success');

        // Reinitialize AI assistant
        if (typeof initializeAI === 'function') {
            initializeAI();
        }
    }
}

function clearOpenAIKey() {
    if (confirm('Are you sure you want to remove the API key?')) {
        localStorage.removeItem('openai_api_key');
        document.getElementById('openaiKeyInput').value = '';
        updateAIStatus(false);
        showNotification('API key removed', 'success');
    }
}

function updateAIStatus(isConfigured) {
    const statusDiv = document.getElementById('aiStatus');
    const statusText = document.getElementById('aiStatusText');

    statusDiv.style.display = 'block';

    if (isConfigured) {
        statusDiv.style.background = '#d1fae5';
        statusDiv.style.color = '#065f46';
        statusText.textContent = 'AI enabled - Features available';
    } else {
        statusDiv.style.background = '#fee2e2';
        statusDiv.style.color = '#991b1b';
        statusText.textContent = 'AI disabled - No key configured';
    }
}

function getExchangeRate() {
    return parseFloat(localStorage.getItem('exchange_rate_usd_idr')) || 15800;
}
</script>

<style>
.settings-section h3 {
    font-size: 1.125rem;
    margin-bottom: 0.75rem;
    color: var(--text-primary);
}

.settings-section ul {
    padding-left: 1.5rem;
    line-height: 1.8;
}
</style>
